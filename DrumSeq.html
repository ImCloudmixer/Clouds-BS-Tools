<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A powerful 32-step drum and melody sequencer with 29 drum patterns and 29 melody patterns. Create beats in your browser!">
    <title>Drum Sequencer - 32 Step Beat Maker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #fff;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sequencer {
            background: #0f1419;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            max-width: 1200px;
            width: 95vw;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .title {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .controls {
            display: flex;
            gap: 20px;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button.playing {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .tempo-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tempo-slider {
            width: 150px;
            height: 6px;
            background: #333;
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .tempo-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            cursor: pointer;
        }

        .grid-container {
            background: #1a1f2e;
            border-radius: 15px;
            padding: 20px;
        }

        .step-numbers {
            display: grid;
            grid-template-columns: 75px repeat(32, 29px);
            gap: 1px;
            margin-bottom: 10px;
        }

        .step-number {
            text-align: center;
            font-size: 0.6rem;
            color: #666;
            padding: 2px;
        }

        .step-number.beat {
            color: #ff6b6b;
            font-weight: bold;
        }

        .grid {
            display: grid;
            grid-template-columns: 75px repeat(32, 29px);
            gap: 1px;
        }

        .track-label {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 15px;
            font-weight: bold;
            color: #ccc;
            font-size: 0.8rem;
        }

        .step.pitch-control {
            cursor: ns-resize;
            position: relative;
        }

        .step.pitch-control.active::after {
            content: attr(data-note);
            position: absolute;
            bottom: 2px;
            left: 2px;
            font-size: 0.6rem;
            color: rgba(255, 255, 255, 0.9);
            background: rgba(0, 0, 0, 0.6);
            padding: 1px 3px;
            border-radius: 2px;
            pointer-events: none;
        }

        .step.pitch-control.dragging {
            border-color: #ff6b6b !important;
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.7) !important;
        }

        .step {
            width: 29px;
            height: 29px;
            border: 1px solid #333;
            border-radius: 4px;
            background: #2a2f3e;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .step:hover {
            border-color: #555;
            transform: scale(1.05);
        }

        .step.active {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            border-color: #4ecdc4;
            box-shadow: 0 0 15px rgba(78, 205, 196, 0.5);
        }

        .step.playing {
            border-color: #ff6b6b;
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.7);
            animation: stepPulse 0.1s ease;
        }

        @keyframes stepPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .step.beat-1, .step.beat-5, .step.beat-9, .step.beat-13 {
            border-left: 4px solid #ff6b6b;
        }

        .track-kick .step.active { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .track-snare .step.active { background: linear-gradient(135deg, #3498db, #2980b9); }
        .track-hihat .step.active { background: linear-gradient(135deg, #f1c40f, #f39c12); }
        .track-openhat .step.active { background: linear-gradient(135deg, #e67e22, #d35400); }
        .track-clap .step.active { background: linear-gradient(135deg, #9b59b6, #8e44ad); }
        .track-crash .step.active { background: linear-gradient(135deg, #34495e, #2c3e50); }
        .track-bass .step.active { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .track-lead .step.active { background: linear-gradient(135deg, #ff6b9d, #f093fb); }
        .track-lead2 .step.active { background: linear-gradient(135deg, #ff6b9d, #f093fb); }

        .pattern-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }



        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }

        .volume-slider {
            width: 200px;
            height: 6px;
            background: #333;
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            border-radius: 50%;
            cursor: pointer;
        }

        .length-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .length-btn {
            width: 40px;
            height: 40px;
            padding: 0;
            border-radius: 50%;
            font-size: 1.2rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .length-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .steps-display {
            background: #2a2f3e;
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid #444;
            min-width: 60px;
            text-align: center;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .step {
                width: 22px;
                height: 22px;
            }
            .length-btn {
                width: 30px;
                height: 30px;
                font-size: 0.8rem;
            }
            .step-number {
                font-size: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="sequencer">
        <div class="header">
            <h1 class="title">Clouds Basic Bitch Sequencer</h1>
        </div>

        <div class="controls">
            <button id="playBtn">Play</button>
            <button id="stopBtn">Stop</button>
            <button id="clearBtn">Clear All</button>
            <div class="tempo-control">
                <label>BPM:</label>
                <input type="range" id="tempoSlider" class="tempo-slider" min="60" max="180" value="120">
                <span id="tempoValue">120</span>
            </div>
        </div>

        <div class="length-control">
            <button id="removeStepsBtn" class="length-btn">âˆ’</button>
            <div class="steps-display" id="stepsDisplay">16</div>
            <button id="addStepsBtn" class="length-btn">+</button>
            <span style="color: #888; font-size: 0.9rem;">Steps (4-step batches)</span>
        </div>

        <div class="grid-container">
            <div class="step-numbers">
                <!-- Step numbers generated dynamically by JavaScript -->
            </div>

            <div class="grid" id="sequencerGrid">
                <!-- Grid will be generated by JavaScript -->
            </div>
        </div>

        <div class="pattern-controls">
            <button id="randomBtn">Random Pattern</button>
            <button id="randomMelodyBtn">Random Melody</button>
        </div>

        <div class="volume-control">
            <label>Volume:</label>
            <input type="range" id="volumeSlider" class="volume-slider" min="0" max="100" value="70">
            <span id="volumeValue">70%</span>
        </div>
    </div>

    <script>
        // ============================================
        // TRACK CONFIGURATION
        // ============================================
        
        // Track definitions with sound generators
        const tracks = [
            { name: 'Kick', className: 'kick', generator: generateKick },
            { name: 'Snare', className: 'snare', generator: generateSnare },
            { name: 'Hi-Hat', className: 'hihat', generator: generateHiHat },
            { name: 'Open Hat', className: 'openhat', generator: generateOpenHat },
            { name: 'Clap', className: 'clap', generator: generateClap },
            { name: 'Crash', className: 'crash', generator: generateCrash },
            { name: 'Bass', className: 'bass', generator: generateBass },
            { name: 'Lead', className: 'lead', generator: generateLead },
            { name: 'Lead 2', className: 'lead2', generator: generateLead2 }
        ];

        // ============================================
        // PRESET PATTERNS
        // ============================================
        
        // Preset drum patterns (drums only - no bass/lead)
        const presetPatterns = {
            basic: [
                [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,1,0], // Kick
                [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], // Snare
                [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0], // Hi-Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0], // Open Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // Clap
                [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]  // Crash
            ],
            funk: [
                [1,0,0,1,0,0,1,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,1,0,0,0,1,0,0,1], // Kick
                [0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,1,0,0,1,0,1,0,0,0], // Snare
                [1,0,1,1,0,1,1,0,1,0,1,1,0,1,1,0,1,0,1,1,0,1,1,0,1,0,1,1,0,1,1,0], // Hi-Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1], // Open Hat
                [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0], // Clap
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]  // Crash
            ],
            house: [
                [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], // Kick
                [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], // Snare
                [0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1], // Hi-Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0], // Open Hat
                [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], // Clap
                [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]  // Crash
            ],
            techno: [
                [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0], // Kick
                [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], // Snare
                [1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1], // Hi-Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0], // Open Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // Clap
                [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0]  // Crash
            ],
            rock: [
                [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,1,0], // Kick
                [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,1,0], // Snare
                [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0], // Hi-Hat
                [0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0], // Open Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // Clap
                [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0]  // Crash
            ],
            disco: [
                [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], // Kick
                [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], // Snare
                [1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1], // Hi-Hat
                [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0], // Open Hat
                [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], // Clap
                [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]  // Crash
            ],
            shuffle: [
                [1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1], // Kick
                [0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0], // Snare
                [1,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0], // Hi-Hat
                [0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0], // Open Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // Clap
                [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]  // Crash
            ],
            latin: [
                [1,0,0,1,0,0,1,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0], // Kick
                [0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,0], // Snare
                [1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0], // Hi-Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1], // Open Hat
                [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], // Clap
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]  // Crash
            ],
            breakbeat: [
                [1,0,0,1,0,0,0,1,1,0,0,1,0,0,0,0,1,0,0,0,1,0,0,1,1,0,0,1,0,0,1,0], // Kick
                [0,0,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,1,0], // Snare
                [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0], // Hi-Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1], // Open Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // Clap
                [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]  // Crash
            ],
            reggae: [
                [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0], // Kick
                [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], // Snare
                [0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1], // Hi-Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // Open Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // Clap
                [0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0]  // Crash
            ],
            trap: [
                [1,0,0,0,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,1,0,0,1,0,0,1], // Kick
                [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0], // Snare
                [1,0,1,1,0,1,1,0,1,0,1,1,0,1,1,0,1,0,1,1,0,1,1,0,1,0,1,1,0,1,1,0], // Hi-Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1], // Open Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], // Clap
                [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]  // Crash
            ],
            dnb: [
                [1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0], // Kick
                [0,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0], // Snare
                [1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1], // Hi-Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1], // Open Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // Clap
                [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]  // Crash
            ],
            dubstep: [
                [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0], // Kick
                [0,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0], // Snare
                [1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0], // Hi-Hat
                [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1], // Open Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], // Clap
                [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]  // Crash
            ],
            garage: [
                [1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1], // Kick
                [0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0], // Snare
                [0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1], // Hi-Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0], // Open Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0], // Clap
                [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]  // Crash
            ],
            afrobeat: [
                [1,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0], // Kick
                [0,0,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,1,0,0,0], // Snare
                [1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0], // Hi-Hat
                [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1], // Open Hat
                [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0], // Clap
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]  // Crash
            ],
            trance: [
                [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], // Kick
                [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0], // Snare
                [0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1], // Hi-Hat
                [0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0], // Open Hat
                [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0], // Clap
                [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // Crash
            ],
            jazz: [
                [1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1], // Kick
                [0,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0], // Snare
                [1,0,1,0,0,1,0,1,0,1,0,0,1,0,1,0,1,0,1,0,0,1,0,1,0,1,0,0,1,0,1,0], // Hi-Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1], // Open Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // Clap
                [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // Crash
            ],
            grunge: [
                [1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0], // Kick
                [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0], // Snare
                [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0], // Hi-Hat
                [0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0], // Open Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], // Clap
                [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0], // Crash
            ],
            progressive: [
                [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,1,1,0,0,0,1,0,0,1,1,0,0,0], // Kick
                [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,1,0,1,0], // Snare
                [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0], // Hi-Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1], // Open Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], // Clap
                [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // Crash
            ],
            industrial: [
                [1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,1,0,0], // Kick
                [0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,1,0], // Snare
                [1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1], // Hi-Hat
                [0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0], // Open Hat
                [0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,1,0], // Clap
                [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // Crash
            ],
            footwork: [
                [1,0,0,1,0,0,1,0,1,0,0,0,1,0,1,0,1,0,0,1,0,0,1,0,1,0,0,0,1,1,0,0], // Kick
                [0,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,1,1,0,0], // Snare
                [1,1,1,1,0,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1,0,0,1,1], // Hi-Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1], // Open Hat
                [0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0], // Clap
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // Crash
            ],
            halftime: [
                [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0], // Kick
                [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0], // Snare
                [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0], // Hi-Hat
                [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0], // Open Hat
                [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0], // Clap
                [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // Crash
            ],
            boom_bap: [
                [1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,0,1,0,0], // Kick
                [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], // Snare
                [1,0,1,1,0,1,0,1,1,0,1,1,0,1,0,1,1,0,1,1,0,1,0,1,1,0,1,1,0,1,1,0], // Hi-Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // Open Hat
                [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], // Clap
                [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // Crash
            ],
            hardstyle: [
                [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0], // Kick
                [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], // Snare
                [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0], // Hi-Hat
                [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1], // Open Hat
                [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], // Clap
                [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // Crash
            ],
            glitch: [
                [1,0,0,1,0,1,0,0,1,0,0,0,1,1,0,0,1,0,0,1,0,1,0,0,1,0,0,0,1,0,1,0], // Kick
                [0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,1], // Snare
                [1,1,0,1,0,1,1,0,1,1,0,1,0,1,1,0,1,1,0,1,0,1,1,0,1,1,0,1,0,1,1,0], // Hi-Hat
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // Open Hat
                [0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0], // Clap
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // Crash
            ],
            minimal_tech: [
                [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], // Kick
                [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0], // Snare
                [0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0], // Hi-Hat
                [0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1], // Open Hat
                [0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0], // Clap
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // Crash
            ],
            uk_garage: [
                [1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,1,0], // Kick
                [0,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0], // Snare
                [1,1,0,1,0,1,1,0,1,1,0,1,0,1,1,0,1,1,0,1,0,1,1,0,1,1,0,1,0,1,0,1], // Hi-Hat
                [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0], // Open Hat
                [0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0], // Clap
                [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // Crash
            ],
            tribal: [
                [1,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,1,1,0], // Kick
                [0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1], // Snare
                [1,1,1,0,1,1,0,1,1,1,1,0,1,1,0,1,1,1,1,0,1,1,0,1,1,1,1,0,1,1,0,0], // Hi-Hat
                [0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0], // Open Hat
                [0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0], // Clap
                [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // Crash
            ]
        };

        // Melody patterns (only for Bass Lead and Lead 2 tracks)
        const melodyPatterns = {
            arpeggio1: {
                bass: [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],
                bassNotes: ['C2','C2','C2','C2','E2','E2','E2','E2','G2','G2','G2','G2','C3','C3','C3','C3','C2','C2','C2','C2','E2','E2','E2','E2','G2','G2','G2','G2','E2','E2','E2','E2'],
                lead: [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
                leadNotes: ['C4','C4','E4','E4','G4','G4','C5','C5','E4','E4','G4','G4','C5','C5','E5','E5','C4','C4','E4','E4','G4','G4','C5','C5','E4','E4','G4','G4','E4','E4','G4','G4'],
                lead2: [0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0],
                lead2Notes: ['C4','G4','C4','G4','E4','C5','E4','C5','G4','E5','G4','E5','C5','G5','C5','G5','C4','G4','C4','G4','E4','C5','E4','C5','G4','E5','G4','E5','E4','C5','E4','C5']
            },
            bassline1: {
                bass: [1,0,0,1,1,0,1,0,1,0,0,1,0,0,1,0,1,0,0,1,1,0,1,0,1,0,0,0,1,0,1,0],
                bassNotes: ['A1','A1','A1','C2','D2','D2','E2','E2','A1','A1','A1','C2','C2','C2','D2','D2','G1','G1','G1','B1','D2','D2','E2','E2','G1','G1','G1','G1','A1','A1','C2','C2'],
                lead: [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
                leadNotes: ['A3','A3','A3','A3','A3','A3','A3','A3','E4','E4','E4','E4','E4','E4','E4','E4','G3','G3','G3','G3','G3','G3','G3','G3','D4','D4','D4','D4','D4','D4','D4','D4'],
                lead2: [0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0],
                lead2Notes: ['C4','C4','C4','C4','C4','C4','C4','C4','C4','C4','A4','A4','A4','A4','A4','A4','B3','B3','B3','B3','B3','B3','B3','B3','B3','B3','G4','G4','G4','G4','G4','G4']
            },
            techno1: {
                bass: [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],
                bassNotes: ['D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','F1','F1','F1','F1','F1','F1','F1','F1','F1','F1','F1','F1','F1','F1','F1','F1'],
                lead: [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],
                leadNotes: ['F3','F3','F3','F3','A3','A3','A3','A3','D4','D4','D4','D4','A3','A3','A3','A3','C4','C4','C4','C4','E4','E4','E4','E4','F4','F4','F4','F4','E4','E4','E4','E4'],
                lead2: [0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1],
                lead2Notes: ['A3','A3','A3','D4','A3','A3','A3','D4','A3','A3','A3','D4','A3','A3','A3','D4','C4','C4','C4','F4','C4','C4','C4','F4','C4','C4','C4','F4','C4','C4','C4','F4']
            },
            minimal1: {
                bass: [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
                bassNotes: ['C1','C1','C1','C1','C1','C1','C1','C1','G1','G1','G1','G1','G1','G1','G1','G1','A#1','A#1','A#1','A#1','A#1','A#1','A#1','A#1','F1','F1','F1','F1','F1','F1','F1','F1'],
                lead: [0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],
                leadNotes: ['C4','C4','C4','C4','G4','G4','G4','G4','G3','G3','G3','G3','G3','G3','G3','G3','D#4','D#4','D#4','D#4','A#4','A#4','A#4','A#4','F3','F3','F3','F3','F3','F3','F3','F3'],
                lead2: [0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],
                lead2Notes: ['E4','E4','E4','E4','E4','E4','E4','E4','D4','D4','D4','D4','D4','D4','D4','D4','G4','G4','G4','G4','G4','G4','G4','G4','C4','C4','C4','C4','C4','C4','C4','C4']
            },
            pluck1: {
                bass: [1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0],
                bassNotes: ['E1','E1','E1','E1','E1','E1','E1','E1','E1','E1','E1','E1','E1','E1','E1','E1','D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','D1'],
                lead: [0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,0],
                leadNotes: ['B3','B3','E4','E4','B3','B3','E4','E4','B3','B3','E4','E4','B3','B3','B3','B3','A3','A3','D4','D4','A3','A3','D4','D4','A3','A3','D4','D4','A3','A3','A3','A3'],
                lead2: [0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0],
                lead2Notes: ['G#4','G#4','G#4','G#4','B4','B4','B4','B4','G#4','G#4','G#4','G#4','E4','E4','E4','E4','F#4','F#4','F#4','F#4','A4','A4','A4','A4','F#4','F#4','F#4','F#4','D4','D4','D4','D4']
            },
            synth1: {
                bass: [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],
                bassNotes: ['F1','F1','F1','F1','F1','F1','F1','F1','C2','C2','C2','C2','F1','F1','F1','F1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','A#1','A#1','A#1','A#1','D#1','D#1','D#1','D#1'],
                lead: [1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0],
                leadNotes: ['F3','F3','F3','F3','F3','F3','A3','A3','A3','A3','A3','A3','C4','C4','C4','C4','D#3','D#3','D#3','D#3','D#3','D#3','G3','G3','G3','G3','G3','G3','A#3','A#3','A#3','A#3'],
                lead2: [0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0],
                lead2Notes: ['C4','C4','C4','C4','C4','C4','C4','C4','E4','E4','E4','E4','E4','E4','E4','E4','A#3','A#3','A#3','A#3','A#3','A#3','A#3','A#3','D4','D4','D4','D4','D4','D4','D4','D4']
            },
            dubstep1: {
                bass: [1,0,0,1,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,1,0,0,1,0,0],
                bassNotes: ['D1','D1','D1','F1','F1','D1','D1','D1','D1','D1','F1','F1','F1','D1','D1','D1','C1','C1','C1','D#1','D#1','C1','C1','C1','C1','C1','D#1','D#1','D#1','C1','C1','C1'],
                lead: [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],
                leadNotes: ['D3','D3','D3','D3','D3','D3','D3','D3','F3','F3','F3','F3','F3','F3','F3','F3','C3','C3','C3','C3','C3','C3','C3','C3','D#3','D#3','D#3','D#3','D#3','D#3','D#3','D#3'],
                lead2: [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1],
                lead2Notes: ['A3','A3','A3','A3','A3','A3','A3','A3','C4','C4','C4','C4','C4','C4','C4','C4','G3','G3','G3','G3','G3','G3','G3','G3','A#3','A#3','A#3','A#3','A#3','A#3','A#3','A#3']
            },
            trance1: {
                bass: [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],
                bassNotes: ['A1','A1','A1','A1','A1','A1','A1','A1','A1','A1','A1','A1','A1','A1','A1','A1','G1','G1','G1','G1','G1','G1','G1','G1','G1','G1','G1','G1','G1','G1','G1','G1'],
                lead: [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
                leadNotes: ['A3','A3','A3','A3','A3','A3','A3','A3','E4','E4','E4','E4','E4','E4','E4','E4','G3','G3','G3','G3','G3','G3','G3','G3','D4','D4','D4','D4','D4','D4','D4','D4'],
                lead2: [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],
                lead2Notes: ['C4','C4','C4','C4','C4','C4','C4','C4','C4','C4','C4','C4','C4','C4','C4','C4','B3','B3','B3','B3','B3','B3','B3','B3','B3','B3','B3','B3','B3','B3','B3','B3']
            },
            ambient1: {
                bass: [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                bassNotes: ['C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','F1','F1','F1','F1','F1','F1','F1','F1','F1','F1','F1','F1','F1','F1','F1','F1'],
                lead: [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
                leadNotes: ['E4','E4','E4','E4','E4','E4','E4','E4','E4','E4','E4','E4','E4','E4','E4','E4','A4','A4','A4','A4','A4','A4','A4','A4','A4','A4','A4','A4','A4','A4','A4','A4'],
                lead2: [0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],
                lead2Notes: ['G4','G4','G4','G4','G4','G4','G4','G4','G4','G4','G4','G4','G4','G4','G4','G4','C5','C5','C5','C5','C5','C5','C5','C5','C5','C5','C5','C5','C5','C5','C5','C5']
            },
            retro1: {
                bass: [1,0,0,0,1,0,0,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,0,0,1,0,0,0,1,1,0,0],
                bassNotes: ['C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','D#1','D#1','D#1','D#1','F1','F1','F1','F1','F1','F1','F1','F1','F1','F1','F1','F1','G1','G1','G1','G1'],
                lead: [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],
                leadNotes: ['C4','C4','C4','C4','D#4','D#4','D#4','D#4','G4','G4','G4','G4','D#4','D#4','D#4','D#4','F4','F4','F4','F4','A4','A4','A4','A4','C5','C5','C5','C5','A4','A4','A4','A4'],
                lead2: [0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],
                lead2Notes: ['G4','G4','G4','G4','A#4','A#4','A#4','A#4','D5','D5','D5','D5','A#4','A#4','A#4','A#4','C5','C5','C5','C5','E5','E5','E5','E5','G5','G5','G5','G5','E5','E5','E5','E5']
            },
            dark_ambient: {
                bass: [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                bassNotes: ['D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1'],
                lead: [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
                leadNotes: ['F3','F3','F3','F3','F3','F3','F3','F3','F3','F3','F3','F3','F3','F3','F3','F3','G3','G3','G3','G3','G3','G3','G3','G3','G3','G3','G3','G3','G3','G3','G3','G3'],
                lead2: [0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],
                lead2Notes: ['A#3','A#3','A#3','A#3','A#3','A#3','A#3','A#3','A#3','A#3','A#3','A#3','A#3','A#3','A#3','A#3','C4','C4','C4','C4','C4','C4','C4','C4','C4','C4','C4','C4','C4','C4','C4','C4']
            },
            horror: {
                bass: [1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0],
                bassNotes: ['C#1','C#1','C#1','C#1','C#1','C#1','D1','D1','D1','D1','D1','D1','D#1','D#1','D#1','D#1','D#1','D#1','E1','E1','E1','E1','E1','E1','F1','F1','F1','F1','F1','F1','F1','F1'],
                lead: [0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0],
                leadNotes: ['G#3','G#3','A3','A3','A3','A3','A3','A3','A#3','A#3','A#3','A#3','A#3','A#3','B3','B3','B3','B3','B3','B3','C4','C4','C4','C4','C4','C4','C#4','C#4','C#4','C#4','C#4','C#4'],
                lead2: [0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0],
                lead2Notes: ['E4','E4','E4','F4','F4','F4','F4','F4','F4','F#4','F#4','F#4','F#4','F#4','F#4','G4','G4','G4','G4','G4','G4','G#4','G#4','G#4','G#4','G#4','G#4','A4','A4','A4','A4','A4']
            },
            melancholy: {
                bass: [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],
                bassNotes: ['A1','A1','A1','A1','A1','A1','A1','A1','G1','G1','G1','G1','G1','G1','G1','G1','F1','F1','F1','F1','F1','F1','F1','F1','E1','E1','E1','E1','E1','E1','E1','E1'],
                lead: [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
                leadNotes: ['C4','C4','C4','C4','C4','C4','E4','E4','E4','E4','E4','E4','D4','D4','D4','D4','D4','D4','B3','B3','B3','B3','B3','B3','A3','A3','A3','A3','A3','A3','G#3','G#3'],
                lead2: [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],
                lead2Notes: ['A3','A3','A3','A3','A3','A3','A3','A3','G3','G3','G3','G3','G3','G3','G3','G3','F3','F3','F3','F3','F3','F3','F3','F3','E3','E3','E3','E3','E3','E3','E3','E3']
            },
            uplifting: {
                bass: [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0],
                bassNotes: ['C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','F1','F1','F1','F1','F1','F1','F1','F1','G1','G1','G1','G1','G1','G1','G1','G1'],
                lead: [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],
                leadNotes: ['C4','C4','C4','C4','E4','E4','E4','E4','G4','G4','G4','G4','C5','C5','C5','C5','A4','A4','A4','A4','C5','C5','C5','C5','F5','F5','F5','F5','D5','D5','D5','D5'],
                lead2: [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
                lead2Notes: ['E4','E4','E4','E4','G4','G4','G4','G4','C5','C5','C5','C5','E5','E5','E5','E5','C5','C5','C5','C5','E5','E5','E5','E5','A5','A5','A5','A5','G5','G5','G5','G5']
            },
            mysterious: {
                bass: [1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],
                bassNotes: ['E1','E1','E1','E1','E1','E1','F1','F1','F1','F1','F1','F1','E1','E1','E1','E1','E1','E1','D1','D1','D1','D1','D1','D1','E1','E1','E1','E1','E1','E1','F#1','F#1'],
                lead: [0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0],
                leadNotes: ['B3','B3','B3','B3','B3','B3','B3','B3','B3','B3','B3','B3','A3','A3','A3','A3','A3','A3','A3','A3','A3','A3','A3','A3','B3','B3','B3','B3','B3','B3','C#4','C#4'],
                lead2: [0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0],
                lead2Notes: ['E4','E4','E4','E4','E4','E4','F4','F4','F4','F4','F4','F4','E4','E4','E4','E4','E4','E4','D4','D4','D4','D4','D4','D4','E4','E4','E4','E4','E4','E4','F#4','F#4']
            },
            aggressive: {
                bass: [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],
                bassNotes: ['E1','E1','E1','E1','E1','E1','D#1','D#1','E1','E1','E1','E1','E1','E1','D#1','D#1','D1','D1','D1','D1','D1','D1','C#1','C#1','D1','D1','D1','D1','D1','D1','D#1','D#1'],
                lead: [1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],
                leadNotes: ['B3','B3','B3','B3','B3','B3','A#3','A#3','B3','B3','B3','B3','B3','B3','A#3','A#3','A3','A3','A3','A3','A3','A3','G#3','G#3','A3','A3','A3','A3','A3','A3','A#3','A#3'],
                lead2: [0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1],
                lead2Notes: ['E4','E4','E4','E4','E4','E4','D#4','D#4','E4','E4','E4','E4','E4','E4','D#4','D#4','D4','D4','D4','D4','D4','D4','C#4','C#4','D4','D4','D4','D4','D4','D4','D#4','D#4']
            },
            dreamy: {
                bass: [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
                bassNotes: ['F1','F1','F1','F1','F1','F1','F1','F1','G1','G1','G1','G1','G1','G1','G1','G1','A1','A1','A1','A1','A1','A1','A1','A1','C2','C2','C2','C2','C2','C2','C2','C2'],
                lead: [0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0],
                leadNotes: ['A4','A4','A4','A4','A4','A4','A4','A4','G4','G4','G4','G4','G4','G4','G4','G4','F4','F4','F4','F4','F4','F4','F4','F4','E4','E4','E4','E4','E4','E4','E4','E4'],
                lead2: [0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0],
                lead2Notes: ['C5','C5','C5','C5','C5','C5','C5','C5','D5','D5','D5','D5','D5','D5','D5','D5','E5','E5','E5','E5','E5','E5','E5','E5','G5','G5','G5','G5','G5','G5','G5','G5']
            },
            funky: {
                bass: [1,0,0,1,1,0,0,0,1,0,1,0,0,1,0,0,1,0,0,1,1,0,0,0,1,0,1,0,0,1,0,0],
                bassNotes: ['G1','G1','G1','G1','A#1','A#1','A#1','A#1','G1','G1','C2','C2','C2','C2','C2','C2','F1','F1','F1','F1','A1','A1','A1','A1','F1','F1','A#1','A#1','A#1','D2','D2','D2'],
                lead: [0,0,1,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,0,0,1],
                leadNotes: ['D4','D4','D4','D4','D4','D4','D4','D4','D4','D4','D4','D4','F4','F4','F4','F4','C4','C4','C4','C4','C4','C4','C4','C4','C4','C4','C4','C4','D4','D4','D4','D4'],
                lead2: [0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0],
                lead2Notes: ['G4','G4','G4','G4','A#4','A#4','A#4','A#4','G4','G4','C5','C5','C5','C5','C5','C5','F4','F4','F4','F4','A4','A4','A4','A4','F4','F4','A#4','A#4','A#4','D5','D5','D5']
            },
            spacey: {
                bass: [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                bassNotes: ['D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','A#1','A#1','A#1','A#1','A#1','A#1','A#1','A#1','A#1','A#1','A#1','A#1','A#1','A#1','A#1','A#1'],
                lead: [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0],
                leadNotes: ['D#4','D#4','D#4','D#4','D#4','D#4','D#4','D#4','D#4','D#4','D#4','D#4','D#4','D#4','D#4','D#4','F4','F4','F4','F4','F4','F4','F4','F4','F4','F4','F4','F4','F4','F4','F4','F4'],
                lead2: [0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],
                lead2Notes: ['A#4','A#4','A#4','A#4','A#4','A#4','A#4','A#4','A#4','A#4','A#4','A#4','A#4','A#4','A#4','A#4','D5','D5','D5','D5','D5','D5','D5','D5','D5','D5','D5','D5','D5','D5','D5','D5']
            },
            energetic: {
                bass: [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],
                bassNotes: ['C2','C2','C2','C2','C2','C2','C2','C2','G1','G1','G1','G1','G1','G1','G1','G1','A#1','A#1','A#1','A#1','A#1','A#1','A#1','A#1','F1','F1','F1','F1','F1','F1','F1','F1'],
                lead: [1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0],
                leadNotes: ['C4','C4','C4','C4','D4','D4','E4','E4','G4','G4','G4','G4','A4','A4','G4','G4','D#4','D#4','D#4','D#4','F4','F4','G4','G4','A#4','A#4','A#4','A#4','C5','C5','A#4','A#4'],
                lead2: [0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0],
                lead2Notes: ['E4','E4','E4','E4','G4','G4','C5','C5','D5','D5','D5','D5','E5','E5','D5','D5','G4','G4','G4','G4','A#4','A#4','D5','D5','F5','F5','F5','F5','G5','G5','F5','F5']
            },
            chill: {
                bass: [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
                bassNotes: ['A1','A1','A1','A1','A1','A1','A1','A1','F1','F1','F1','F1','F1','F1','F1','F1','G1','G1','G1','G1','G1','G1','G1','G1','E1','E1','E1','E1','E1','E1','E1','E1'],
                lead: [0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0],
                leadNotes: ['E4','E4','E4','E4','E4','E4','E4','E4','C4','C4','C4','C4','C4','C4','C4','C4','D4','D4','D4','D4','D4','D4','D4','D4','B3','B3','B3','B3','B3','B3','B3','B3'],
                lead2: [0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0],
                lead2Notes: ['A4','A4','A4','A4','A4','A4','A4','A4','F4','F4','F4','F4','F4','F4','F4','F4','G4','G4','G4','G4','G4','G4','G4','G4','E4','E4','E4','E4','E4','E4','E4','E4']
            },
            staccato: {
                bass: [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],
                bassNotes: ['D1','D1','F1','F1','A1','A1','D2','D2','D1','D1','F1','F1','A1','A1','C2','C2','C1','C1','E1','E1','G1','G1','C2','C2','C1','C1','E1','E1','G1','G1','A#1','A#1'],
                lead: [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],
                leadNotes: ['D3','D3','F3','F3','A3','A3','D4','D4','D3','D3','F3','F3','A3','A3','C4','C4','C3','C3','E3','E3','G3','G3','C4','C4','C3','C3','E3','E3','G3','G3','A#3','A#3'],
                lead2: [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],
                lead2Notes: ['F4','F4','A4','A4','D5','D5','F5','F5','F4','F4','A4','A4','D5','D5','E5','E5','E4','E4','G4','G4','C5','C5','E5','E5','E4','E4','G4','G4','C5','C5','D5','D5']
            },
            haunting: {
                bass: [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                bassNotes: ['C#1','C#1','C#1','C#1','C#1','C#1','C#1','C#1','C#1','C#1','C#1','C#1','C#1','C#1','C#1','C#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1','D#1'],
                lead: [0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],
                leadNotes: ['G#3','G#3','G#3','G#3','G#3','G#3','G#3','G#3','G#3','G#3','G#3','G#3','G#3','G#3','G#3','G#3','A#3','A#3','A#3','A#3','A#3','A#3','A#3','A#3','A#3','A#3','A#3','A#3','A#3','A#3','A#3','A#3'],
                lead2: [0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],
                lead2Notes: ['C#4','C#4','C#4','C#4','C#4','C#4','C#4','C#4','C#4','C#4','C#4','C#4','C#4','C#4','C#4','C#4','D#4','D#4','D#4','D#4','D#4','D#4','D#4','D#4','D#4','D#4','D#4','D#4','D#4','D#4','D#4','D#4']
            },
            oriental: {
                bass: [1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0],
                bassNotes: ['D1','D1','D1','D1','D1','D1','F1','F1','F1','F1','F1','F1','G1','G1','G1','G1','D1','D1','D1','D1','D1','D1','F1','F1','F1','F1','F1','F1','A1','A1','A1','A1'],
                lead: [0,1,0,0,1,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,0,0],
                leadNotes: ['A3','A3','A3','A3','A#3','A#3','A#3','A#3','D4','D4','D4','D4','E4','E4','E4','E4','A3','A3','A3','A3','A#3','A#3','A#3','A#3','D4','D4','D4','D4','F4','F4','F4','F4'],
                lead2: [0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,0],
                lead2Notes: ['D4','D4','D4','D4','F4','F4','F4','F4','G4','G4','G4','G4','A4','A4','A4','A4','D4','D4','D4','D4','F4','F4','F4','F4','G4','G4','G4','G4','C5','C5','C5','C5']
            },
            cinematic: {
                bass: [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                bassNotes: ['C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','G1','G1','G1','G1','G1','G1','G1','G1','G1','G1','G1','G1','G1','G1','G1','G1'],
                lead: [0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],
                leadNotes: ['E4','E4','E4','E4','E4','E4','E4','E4','F4','F4','F4','F4','G4','G4','G4','G4','D4','D4','D4','D4','D4','D4','D4','D4','E4','E4','E4','E4','F4','F4','F4','F4'],
                lead2: [0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],
                lead2Notes: ['G4','G4','G4','G4','G4','G4','G4','G4','A4','A4','A4','A4','C5','C5','C5','C5','G4','G4','G4','G4','G4','G4','G4','G4','A4','A4','A4','A4','B4','B4','B4','B4']
            },
            robotic: {
                bass: [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],
                bassNotes: ['C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','A#0','A#0','A#0','A#0','A#0','A#0','A#0','A#0','A#0','A#0','A#0','A#0','A#0','A#0','A#0','A#0'],
                lead: [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],
                leadNotes: ['C3','C3','C3','C3','D#3','D#3','D#3','D#3','G3','G3','G3','G3','C4','C4','C4','C4','A#2','A#2','A#2','A#2','D3','D3','D3','D3','F3','F3','F3','F3','A#3','A#3','A#3','A#3'],
                lead2: [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
                lead2Notes: ['G3','G3','G3','G3','A#3','A#3','A#3','A#3','D4','D4','D4','D4','G4','G4','G4','G4','F3','F3','F3','F3','A#3','A#3','A#3','A#3','D4','D4','D4','D4','F4','F4','F4','F4']
            },
            bouncy: {
                bass: [1,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0],
                bassNotes: ['G1','G1','G1','G1','G1','A#1','A#1','A#1','C2','C2','C2','C2','C2','D2','D2','D2','F1','F1','F1','F1','F1','A1','A1','A1','A#1','A#1','A#1','A#1','A#1','C2','C2','C2'],
                lead: [0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0],
                leadNotes: ['D4','D4','D4','D4','D4','D4','D4','D4','G4','G4','G4','G4','G4','G4','G4','G4','C4','C4','C4','C4','C4','C4','C4','C4','F4','F4','F4','F4','F4','F4','F4','F4'],
                lead2: [0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,0],
                lead2Notes: ['G4','G4','G4','G4','A#4','A#4','A#4','A#4','C5','C5','C5','C5','D5','D5','D5','D5','F4','F4','F4','F4','A4','A4','A4','A4','A#4','A#4','A#4','A#4','C5','C5','C5','C5']
            },
            epic: {
                bass: [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],
                bassNotes: ['D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','D1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1','C1'],
                lead: [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
                leadNotes: ['D4','D4','D4','D4','D4','D4','D4','D4','F4','F4','F4','F4','F4','F4','F4','F4','A4','A4','A4','A4','A4','A4','A4','A4','D5','D5','D5','D5','D5','D5','D5','D5'],
                lead2: [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],
                lead2Notes: ['A4','A4','A4','A4','A4','A4','A4','A4','C5','C5','C5','C5','C5','C5','C5','C5','E5','E5','E5','E5','E5','E5','E5','E5','A5','A5','A5','A5','A5','A5','A5','A5']
            },
            chaotic: {
                bass: [1,0,1,1,0,1,0,0,1,1,0,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,0],
                bassNotes: ['F#1','F#1','G1','D1','D1','F#1','F#1','F#1','G1','A1','A1','F#1','F#1','G1','G1','G1','F1','F1','F#1','E1','E1','F1','F1','F1','F#1','G1','G1','G1','F#1','F#1','G1','G1'],
                lead: [0,1,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,1,0],
                leadNotes: ['C#4','C#4','D4','A3','A3','C#4','C#4','C#4','D4','E4','E4','C#4','C#4','D4','D4','D4','C4','C4','C#4','B3','B3','C4','C4','C4','C#4','D4','D4','D4','C#4','C#4','D4','D4'],
                lead2: [0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,1],
                lead2Notes: ['F#4','F#4','G4','D4','D4','F#4','F#4','F#4','G4','A4','A4','F#4','F#4','G4','G4','G4','F4','F4','F#4','E4','E4','F4','F4','F4','F#4','G4','G4','G4','F#4','F#4','G4','G4']
            }
        };

        // ============================================
        // GLOBAL STATE VARIABLES
        // ============================================
        
        // Audio context and playback
        let audioContext;
        let masterGain;
        let isPlaying = false;
        let currentStep = 0;
        let intervalId;
        
        // Pattern data
        let stepCount = 32;
        let pattern = Array(tracks.length).fill().map(() => Array(stepCount).fill(false));
        let currentPresetPattern = null; // Store the current loaded preset pattern
        let currentMelodyPattern = null; // Store the current loaded melody pattern

        // Individual step notes (separate from pattern boolean data)
        let stepNotes = {}; // stepNotes[trackIndex][step] = 'C4', etc.

        // ============================================
        // NOTE CONFIGURATION
        // ============================================
        
        // Note frequencies (C0 to B4 range)
        const noteFrequencies = {
            'C0': 16.35, 'C#0': 17.32, 'D0': 18.35, 'D#0': 19.45, 'E0': 20.60, 'F0': 21.83, 'F#0': 23.12, 'G0': 24.50, 'G#0': 25.96, 'A0': 27.50, 'A#0': 29.14, 'B0': 30.87,
            'C1': 32.70, 'C#1': 34.65, 'D1': 36.71, 'D#1': 38.89, 'E1': 41.20, 'F1': 43.65, 'F#1': 46.25, 'G1': 49.00, 'G#1': 51.91, 'A1': 55.00, 'A#1': 58.27, 'B1': 61.74,
            'C2': 65.41, 'C#2': 69.30, 'D2': 73.42, 'D#2': 77.78, 'E2': 82.41, 'F2': 87.31, 'F#2': 92.50, 'G2': 98.00, 'G#2': 103.83, 'A2': 110.00, 'A#2': 116.54, 'B2': 123.47,
            'C3': 130.81, 'C#3': 138.59, 'D3': 146.83, 'D#3': 155.56, 'E3': 164.81, 'F3': 174.61, 'F#3': 185.00, 'G3': 196.00, 'G#3': 207.65, 'A3': 220.00, 'A#3': 233.08, 'B3': 246.94,
            'C4': 261.63, 'C#4': 277.18, 'D4': 293.66, 'D#4': 311.13, 'E4': 329.63, 'F4': 349.23, 'F#4': 369.99, 'G4': 392.00, 'G#4': 415.30, 'A4': 440.00, 'A#4': 466.16, 'B4': 493.88
        };

        const noteNames = ['C0', 'C#0', 'D0', 'D#0', 'E0', 'F0', 'F#0', 'G0', 'G#0', 'A0', 'A#0', 'B0',
                          'C1', 'C#1', 'D1', 'D#1', 'E1', 'F1', 'F#1', 'G1', 'G#1', 'A1', 'A#1', 'B1',
                          'C2', 'C#2', 'D2', 'D#2', 'E2', 'F2', 'F#2', 'G2', 'G#2', 'A2', 'A#2', 'B2',
                          'C3', 'C#3', 'D3', 'D#3', 'E3', 'F3', 'F#3', 'G3', 'G#3', 'A3', 'A#3', 'B3',
                          'C4', 'C#4', 'D4', 'D#4', 'E4', 'F4', 'F#4', 'G4', 'G#4', 'A4', 'A#4', 'B4'];

        // ============================================
        // DOM ELEMENT REFERENCES
        // ============================================
        
        // DOM elements
        const playBtn = document.getElementById('playBtn');
        const stopBtn = document.getElementById('stopBtn');
        const clearBtn = document.getElementById('clearBtn');
        const tempoSlider = document.getElementById('tempoSlider');
        const tempoValue = document.getElementById('tempoValue');
        const volumeSlider = document.getElementById('volumeSlider');
        const volumeValue = document.getElementById('volumeValue');
        const randomBtn = document.getElementById('randomBtn');
        const randomMelodyBtn = document.getElementById('randomMelodyBtn');
        const grid = document.getElementById('sequencerGrid');
        const addStepsBtn = document.getElementById('addStepsBtn');
        const removeStepsBtn = document.getElementById('removeStepsBtn');
        const stepsDisplay = document.getElementById('stepsDisplay');

        // ============================================
        // AUDIO INITIALIZATION
        // ============================================
        
        // Initialize audio context
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                masterGain = audioContext.createGain();
                masterGain.gain.value = 0.7;
                masterGain.connect(audioContext.destination);
            }
        }

        // ============================================
        // UI GENERATION FUNCTIONS
        // ============================================
        
        // Create step numbers header
        function createStepNumbers() {
            const stepNumbers = document.querySelector('.step-numbers');
            stepNumbers.innerHTML = '';
            stepNumbers.style.gridTemplateColumns = `75px repeat(${stepCount}, 29px)`;
            
            // Empty space above track labels
            const emptyDiv = document.createElement('div');
            emptyDiv.className = 'step-number';
            stepNumbers.appendChild(emptyDiv);
            
            // Step numbers
            for (let i = 0; i < stepCount; i++) {
                const stepNumber = document.createElement('div');
                stepNumber.className = 'step-number';
                if (i % 4 === 0) {
                    stepNumber.classList.add('beat');
                }
                stepNumber.textContent = i + 1;
                stepNumbers.appendChild(stepNumber);
            }
        }

        // Create the sequencer grid
        function createGrid() {
            grid.innerHTML = '';
            grid.style.gridTemplateColumns = `75px repeat(${stepCount}, 29px)`;
            
            tracks.forEach((track, trackIndex) => {
                // Track label
                const label = document.createElement('div');
                label.className = 'track-label';
                label.textContent = track.name;
                grid.appendChild(label);

                // Steps for this track
                for (let step = 0; step < stepCount; step++) {
                    const stepElement = document.createElement('div');
                    stepElement.className = `step track-${track.className} beat-${(step % 4) + 1}`;
                    stepElement.dataset.track = trackIndex;
                    stepElement.dataset.step = step;

                    // Add pitch control for bass and lead tracks
                    if (track.className === 'bass' || track.className === 'lead' || track.className === 'lead2') {
                        stepElement.classList.add('pitch-control');
                        
                        // Initialize default note if not set
                        if (!stepNotes[trackIndex]) stepNotes[trackIndex] = {};
                        if (!stepNotes[trackIndex][step]) {
                            stepNotes[trackIndex][step] = track.className === 'bass' ? 'C2' : 'C4';
                        }
                        
                        stepElement.dataset.note = stepNotes[trackIndex][step];
                        
                        // Add click and scroll listeners for pitch control
                        stepElement.addEventListener('click', (e) => {
                            e.preventDefault();
                            toggleStep(trackIndex, step);
                        });
                        
                        stepElement.addEventListener('wheel', (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            
                            // Only change pitch if step is active
                            if (pattern[trackIndex] && pattern[trackIndex][step]) {
                                const direction = e.deltaY > 0 ? -1 : 1; // Scroll up = higher pitch
                                changeStepNote(trackIndex, step, direction);
                            }
                        });
                        
                        // Touch support for mobile
                        let touchStartY = 0;
                        stepElement.addEventListener('touchstart', (e) => {
                            if (pattern[trackIndex] && pattern[trackIndex][step]) {
                                touchStartY = e.touches[0].clientY;
                            }
                        });
                        
                        stepElement.addEventListener('touchmove', (e) => {
                            if (pattern[trackIndex] && pattern[trackIndex][step]) {
                                e.preventDefault();
                                const deltaY = touchStartY - e.touches[0].clientY;
                                if (Math.abs(deltaY) > 20) { // Threshold for note change
                                    const direction = deltaY > 0 ? 1 : -1;
                                    changeStepNote(trackIndex, step, direction);
                                    touchStartY = e.touches[0].clientY; // Reset for next change
                                }
                            }
                        });
                    } else {
                        stepElement.addEventListener('click', () => toggleStep(trackIndex, step));
                    }

                    if (pattern[trackIndex] && pattern[trackIndex][step]) {
                        stepElement.classList.add('active');
                    }

                    grid.appendChild(stepElement);
                }
            });
            
            createStepNumbers();
        }

        // Toggle step on/off
        function toggleStep(trackIndex, step) {
            if (!pattern[trackIndex]) {
                pattern[trackIndex] = Array(stepCount).fill(false);
            }
            pattern[trackIndex][step] = !pattern[trackIndex][step];
            const stepElement = document.querySelector(`[data-track="${trackIndex}"][data-step="${step}"]`);
            stepElement.classList.toggle('active', pattern[trackIndex][step]);
        }

        // ============================================
        // STEP MANAGEMENT FUNCTIONS
        // ============================================
        
        // Add 4 steps
        function addSteps() {
            if (stepCount >= 32) return; // Maximum limit
            
            stepCount += 4;
            
            // Extend all track patterns
            pattern = pattern.map((track, trackIndex) => {
                const newTrack = Array(stepCount).fill(false);
                for (let i = 0; i < track.length; i++) {
                    newTrack[i] = track[i];
                }
                
                // If we have a loaded preset pattern, reveal more of it (for drum tracks only 0-5)
                if (currentPresetPattern && trackIndex < 6 && currentPresetPattern[trackIndex]) {
                    for (let i = track.length; i < Math.min(stepCount, 32); i++) {
                        newTrack[i] = currentPresetPattern[trackIndex][i] || false;
                    }
                }
                
                // If we have a loaded melody pattern, reveal more of it (for melody tracks)
                if (currentMelodyPattern) {
                    if (trackIndex === 6) { // Bass Lead
                        for (let i = track.length; i < Math.min(stepCount, 32); i++) {
                            newTrack[i] = currentMelodyPattern.bass[i] || false;
                        }
                    } else if (trackIndex === 7) { // Lead
                        for (let i = track.length; i < Math.min(stepCount, 32); i++) {
                            newTrack[i] = currentMelodyPattern.lead[i] || false;
                        }
                    } else if (trackIndex === 8) { // Lead 2
                        for (let i = track.length; i < Math.min(stepCount, 32); i++) {
                            newTrack[i] = currentMelodyPattern.lead2[i] || false;
                        }
                    }
                }
                
                return newTrack;
            });
            
            updateStepDisplay();
            createGrid();
        }

        // Remove 4 steps
        function removeSteps() {
            if (stepCount <= 4) return; // Minimum limit
            
            stepCount -= 4;
            
            // Truncate all track patterns
            pattern = pattern.map(track => track.slice(0, stepCount));
            
            updateStepDisplay();
            createGrid();
        }

        // Update steps display and button states
        function updateStepDisplay() {
            stepsDisplay.textContent = stepCount;
            removeStepsBtn.disabled = stepCount <= 4;
            addStepsBtn.disabled = stepCount >= 32;
        }

        // ============================================
        // NOTE CONTROL FUNCTIONS
        // ============================================
        
        // Pitch control functions
        function changeStepNote(trackIndex, stepIndex, direction) {
            // Initialize step note if not set
            if (!stepNotes[trackIndex]) stepNotes[trackIndex] = {};
            if (!stepNotes[trackIndex][stepIndex]) {
                stepNotes[trackIndex][stepIndex] = tracks[trackIndex].className === 'bass' ? 'C2' : 'C4';
            }
            
            // Get current note and find its index
            const currentNote = stepNotes[trackIndex][stepIndex];
            const currentIndex = noteNames.indexOf(currentNote);
            
            // Calculate new index with bounds checking
            const newIndex = Math.max(0, Math.min(noteNames.length - 1, currentIndex + direction));
            const newNote = noteNames[newIndex];
            
            // Only update if note actually changed
            if (newNote !== currentNote) {
                // Update step note
                stepNotes[trackIndex][stepIndex] = newNote;
                
                // Update visual display
                const stepElement = document.querySelector(`[data-track="${trackIndex}"][data-step="${stepIndex}"]`);
                if (stepElement) {
                    stepElement.dataset.note = newNote;
                    
                    // Add visual feedback
                    stepElement.classList.add('dragging');
                    setTimeout(() => {
                        stepElement.classList.remove('dragging');
                    }, 150);
                }
                
                // Play the new note for audio feedback
                playNotePreview(trackIndex, newNote);
            }
        }

        // Play a preview of the note when scrolling
        function playNotePreview(trackIndex, noteName) {
            if (!audioContext) return;
            
            const frequency = noteFrequencies[noteName] || 261.63;
            const trackType = tracks[trackIndex].className;
            
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            
            // Use appropriate waveform for track type
            if (trackType === 'bass') {
                osc.type = 'sawtooth';
                gain.gain.setValueAtTime(0.3, audioContext.currentTime);
                
                // Add filter for bass
                const filter = audioContext.createBiquadFilter();
                filter.type = 'lowpass';
                filter.frequency.value = Math.min(300 + frequency, 800);
                
                osc.connect(filter);
                filter.connect(gain);
            } else if (trackType === 'lead' || trackType === 'lead2') {
                osc.type = 'square';
                gain.gain.setValueAtTime(0.15, audioContext.currentTime);
                
                // Add filter for lead
                const filter = audioContext.createBiquadFilter();
                filter.type = 'lowpass';
                filter.frequency.value = Math.min(2000 + frequency * 0.5, 4000);
                
                osc.connect(filter);
                filter.connect(gain);
            } else {
                osc.connect(gain);
            }
            
            osc.frequency.setValueAtTime(frequency, audioContext.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
            gain.connect(masterGain);
            
            osc.start(audioContext.currentTime);
            osc.stop(audioContext.currentTime + 0.2);
        }

        // ============================================
        // PLAYBACK CONTROL FUNCTIONS
        // ============================================
        
        // Play the sequencer
        function play() {
            initAudio();
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }

            isPlaying = true;
            playBtn.classList.add('playing');
            playBtn.textContent = 'Playing...';

            const tempo = parseInt(tempoSlider.value);
            const stepTime = (60 / tempo / 4) * 1000; // 16th notes

            intervalId = setInterval(() => {
                // Clear previous highlights
                document.querySelectorAll('.step.playing').forEach(el => el.classList.remove('playing'));

                // Play sounds for current step
                tracks.forEach((track, trackIndex) => {
                    if (pattern[trackIndex][currentStep]) {
                        track.generator();
                        // Highlight active steps
                        const stepElement = document.querySelector(`[data-track="${trackIndex}"][data-step="${currentStep}"]`);
                        stepElement.classList.add('playing');
                    }
                });

                currentStep = (currentStep + 1) % stepCount;
            }, stepTime);
        }

        // Stop the sequencer
        function stop() {
            isPlaying = false;
            clearInterval(intervalId);
            currentStep = 0;
            playBtn.classList.remove('playing');
            playBtn.textContent = 'Play';

            // Clear all highlights
            document.querySelectorAll('.step.playing').forEach(el => el.classList.remove('playing'));
        }

        // Clear all patterns
        function clearAll() {
            pattern = Array(tracks.length).fill().map(() => Array(stepCount).fill(false));
            stepNotes = {}; // Clear all step notes
            currentPresetPattern = null; // Clear stored preset pattern
            createGrid();
        }

        // ============================================
        // PATTERN GENERATION FUNCTIONS
        // ============================================
        
        // Generate random drum pattern from presets
        function generateRandomPattern() {
            const patternNames = ['basic', 'funk', 'house', 'techno', 'rock', 'disco', 'shuffle', 'latin', 'breakbeat', 'reggae', 'trap', 'dnb', 'dubstep', 'garage', 'afrobeat', 'trance', 'jazz', 'grunge', 'progressive', 'industrial', 'footwork', 'halftime', 'boom_bap', 'hardstyle', 'glitch', 'minimal_tech', 'uk_garage', 'tribal'];
            const randomPattern = patternNames[Math.floor(Math.random() * patternNames.length)];
            
            // Store the full preset pattern
            currentPresetPattern = presetPatterns[randomPattern];
            
            // Load drum pattern (only 6 tracks in preset)
            // Update only the first 6 tracks (drums), preserve melody tracks 6-8
            for (let i = 0; i < 6; i++) {
                pattern[i] = currentPresetPattern[i].slice(0, stepCount).concat(Array(Math.max(0, stepCount - currentPresetPattern[i].length)).fill(false));
            }
            createGrid();
        }

        function generateRandomMelody() {
            const melodyNames = ['arpeggio1', 'bassline1', 'techno1', 'minimal1', 'pluck1', 'synth1', 'dubstep1', 'trance1', 'ambient1', 'retro1', 'dark_ambient', 'horror', 'melancholy', 'uplifting', 'mysterious', 'aggressive', 'dreamy', 'funky', 'spacey', 'energetic', 'chill', 'staccato', 'haunting', 'oriental', 'cinematic', 'robotic', 'bouncy', 'epic', 'chaotic'];
            const randomMelody = melodyNames[Math.floor(Math.random() * melodyNames.length)];
            const melody = melodyPatterns[randomMelody];
            
            // Store the full melody pattern for later expansion
            currentMelodyPattern = melody;
            
            // Apply melody to Bass Lead (track 6), Lead (track 7), and Lead 2 (track 8)
            // Keep existing drum patterns intact
            pattern[6] = melody.bass.slice(0, stepCount).concat(Array(Math.max(0, stepCount - melody.bass.length)).fill(false));
            pattern[7] = melody.lead.slice(0, stepCount).concat(Array(Math.max(0, stepCount - melody.lead.length)).fill(false));
            pattern[8] = melody.lead2.slice(0, stepCount).concat(Array(Math.max(0, stepCount - melody.lead2.length)).fill(false));
            
            // Set the notes for ALL 32 steps (not just visible ones)
            stepNotes[6] = {}; // Clear existing notes for Bass
            stepNotes[7] = {}; // Clear existing notes for Lead
            stepNotes[8] = {}; // Clear existing notes for Lead 2
            
            for (let i = 0; i < 32; i++) {
                if (melody.bass[i] && melody.bassNotes[i]) {
                    stepNotes[6][i] = melody.bassNotes[i];
                }
                if (melody.lead[i] && melody.leadNotes[i]) {
                    stepNotes[7][i] = melody.leadNotes[i];
                }
                if (melody.lead2[i] && melody.lead2Notes[i]) {
                    stepNotes[8][i] = melody.lead2Notes[i];
                }
            }
            
            createGrid();
        }

        // ============================================
        // TEMPO & VOLUME CONTROLS
        // ============================================
        
        // Update tempo display
        function updateTempo() {
            tempoValue.textContent = tempoSlider.value;
            if (isPlaying) {
                stop();
                play();
            }
        }

        // Update volume
        function updateVolume() {
            const volume = parseInt(volumeSlider.value);
            volumeValue.textContent = volume + '%';
            if (masterGain) {
                masterGain.gain.value = volume / 100;
            }
        }

        // ============================================
        // SOUND GENERATION FUNCTIONS - DRUMS
        // ============================================
        
        // Sound generators using Web Audio API
        function generateKick() {
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            
            osc.type = 'sine';
            osc.frequency.setValueAtTime(70, audioContext.currentTime);
            osc.frequency.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            gain.gain.setValueAtTime(2.0, audioContext.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            osc.connect(gain);
            gain.connect(masterGain);
            
            osc.start(audioContext.currentTime);
            osc.stop(audioContext.currentTime + 0.5);
        }

        function generateSnare() {
            // Noise component
            const bufferSize = audioContext.sampleRate * 0.2;
            const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const data = buffer.getChannelData(0);
            
            for (let i = 0; i < bufferSize; i++) {
                data[i] = Math.random() * 2 - 1;
            }
            
            const noise = audioContext.createBufferSource();
            noise.buffer = buffer;
            
            const noiseFilter = audioContext.createBiquadFilter();
            noiseFilter.type = 'highpass';
            noiseFilter.frequency.value = 1000;
            
            const noiseGain = audioContext.createGain();
            noiseGain.gain.setValueAtTime(0.5, audioContext.currentTime);
            noiseGain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
            
            noise.connect(noiseFilter);
            noiseFilter.connect(noiseGain);
            noiseGain.connect(masterGain);
            
            // Tonal component
            const osc = audioContext.createOscillator();
            const oscGain = audioContext.createGain();
            
            osc.type = 'triangle';
            osc.frequency.value = 200;
            
            oscGain.gain.setValueAtTime(0.3, audioContext.currentTime);
            oscGain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
            
            osc.connect(oscGain);
            oscGain.connect(masterGain);
            
            noise.start(audioContext.currentTime);
            osc.start(audioContext.currentTime);
            noise.stop(audioContext.currentTime + 0.2);
            osc.stop(audioContext.currentTime + 0.1);
        }

        function generateHiHat() {
            const bufferSize = audioContext.sampleRate * 0.1;
            const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const data = buffer.getChannelData(0);
            
            for (let i = 0; i < bufferSize; i++) {
                data[i] = Math.random() * 2 - 1;
            }
            
            const noise = audioContext.createBufferSource();
            noise.buffer = buffer;
            
            const filter = audioContext.createBiquadFilter();
            filter.type = 'highpass';
            filter.frequency.value = 8000;
            
            const gain = audioContext.createGain();
            gain.gain.setValueAtTime(0.7, audioContext.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
            
            noise.connect(filter);
            filter.connect(gain);
            gain.connect(masterGain);
            
            noise.start(audioContext.currentTime);
            noise.stop(audioContext.currentTime + 0.1);
        }

        function generateOpenHat() {
            const bufferSize = audioContext.sampleRate * 0.5;
            const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const data = buffer.getChannelData(0);
            
            for (let i = 0; i < bufferSize; i++) {
                data[i] = Math.random() * 2 - 1;
            }
            
            const noise = audioContext.createBufferSource();
            noise.buffer = buffer;
            
            const filter = audioContext.createBiquadFilter();
            filter.type = 'bandpass';
            filter.frequency.value = 6000;
            filter.Q.value = 2;
            
            const gain = audioContext.createGain();
            gain.gain.setValueAtTime(0.7, audioContext.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            noise.connect(filter);
            filter.connect(gain);
            gain.connect(masterGain);
            
            noise.start(audioContext.currentTime);
            noise.stop(audioContext.currentTime + 0.5);
        }

        function generateClap() {
            // Multiple short noise bursts
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    const bufferSize = audioContext.sampleRate * 0.05;
                    const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
                    const data = buffer.getChannelData(0);
                    
                    for (let j = 0; j < bufferSize; j++) {
                        data[j] = Math.random() * 2 - 1;
                    }
                    
                    const noise = audioContext.createBufferSource();
                    noise.buffer = buffer;
                    
                    const filter = audioContext.createBiquadFilter();
                    filter.type = 'bandpass';
                    filter.frequency.value = 2000;
                    filter.Q.value = 5;
                    
                    const gain = audioContext.createGain();
                    gain.gain.setValueAtTime(2.0, audioContext.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.05);
                    
                    noise.connect(filter);
                    filter.connect(gain);
                    gain.connect(masterGain);
                    
                    noise.start(audioContext.currentTime);
                    noise.stop(audioContext.currentTime + 0.05);
                }, i * 10);
            }
        }

        function generateCrash() {
            const bufferSize = audioContext.sampleRate * 2;
            const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const data = buffer.getChannelData(0);
            
            for (let i = 0; i < bufferSize; i++) {
                data[i] = Math.random() * 2 - 1;
            }
            
            const noise = audioContext.createBufferSource();
            noise.buffer = buffer;
            
            const filter = audioContext.createBiquadFilter();
            filter.type = 'highpass';
            filter.frequency.value = 3000;
            
            const gain = audioContext.createGain();
            gain.gain.setValueAtTime(0.4, audioContext.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 2);
            
            noise.connect(filter);
            filter.connect(gain);
            gain.connect(masterGain);
            
            noise.start(audioContext.currentTime);
            noise.stop(audioContext.currentTime + 2);
        }

        // ============================================
        // SOUND GENERATION FUNCTIONS - MELODIC
        // ============================================
        
        // Generate bass sound (with pitch control)
        function generateBass() {
            // Get the note for this specific step
            const bassTrackIndex = tracks.findIndex(t => t.className === 'bass');
            const stepNote = (stepNotes[bassTrackIndex] && stepNotes[bassTrackIndex][currentStep]) || 'C2';
            const frequency = noteFrequencies[stepNote] || 65.41;
            
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(frequency, audioContext.currentTime);
            
            gain.gain.setValueAtTime(0.6, audioContext.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            const filter = audioContext.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = Math.min(300 + frequency, 800); // Adjust filter based on pitch
            
            osc.connect(filter);
            filter.connect(gain);
            gain.connect(masterGain);
            
            osc.start(audioContext.currentTime);
            osc.stop(audioContext.currentTime + 0.3);
        }

        function generateLead() {
            // Get the note for this specific step
            const leadTrackIndex = tracks.findIndex(t => t.className === 'lead');
            const stepNote = (stepNotes[leadTrackIndex] && stepNotes[leadTrackIndex][currentStep]) || 'C4';
            const frequency = noteFrequencies[stepNote] || 261.63;
            
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            
            osc.type = 'square';
            osc.frequency.setValueAtTime(frequency, audioContext.currentTime);
            
            gain.gain.setValueAtTime(0.3, audioContext.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
            
            const filter = audioContext.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = Math.min(2000 + frequency * 0.5, 4000); // Adjust filter based on pitch
            
            osc.connect(filter);
            filter.connect(gain);
            gain.connect(masterGain);
            
            osc.start(audioContext.currentTime);
            osc.stop(audioContext.currentTime + 0.2);
        }

        function generateLead2() {
            // Get the note for this specific step
            const lead2TrackIndex = tracks.findIndex(t => t.className === 'lead2');
            const stepNote = (stepNotes[lead2TrackIndex] && stepNotes[lead2TrackIndex][currentStep]) || 'C4';
            const frequency = noteFrequencies[stepNote] || 261.63;
            
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            
            osc.type = 'square'; // Same as Lead 1
            osc.frequency.setValueAtTime(frequency, audioContext.currentTime);
            
            gain.gain.setValueAtTime(0.3, audioContext.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
            
            const filter = audioContext.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = Math.min(2000 + frequency * 0.5, 4000); // Same filter as Lead 1
            
            osc.connect(filter);
            filter.connect(gain);
            gain.connect(masterGain);
            
            osc.start(audioContext.currentTime);
            osc.stop(audioContext.currentTime + 0.2);
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================
        
        // Event listeners
        playBtn.addEventListener('click', () => {
            if (isPlaying) {
                stop();
            } else {
                play();
            }
        });

        stopBtn.addEventListener('click', stop);
        clearBtn.addEventListener('click', clearAll);
        tempoSlider.addEventListener('input', updateTempo);
        volumeSlider.addEventListener('input', updateVolume);
        randomBtn.addEventListener('click', generateRandomPattern);
        randomMelodyBtn.addEventListener('click', generateRandomMelody);
        addStepsBtn.addEventListener('click', addSteps);
        removeStepsBtn.addEventListener('click', removeSteps);

        // ============================================
        // INITIALIZATION
        // ============================================
        
        // Initialize
        updateStepDisplay();
        createGrid(); // This also calls createStepNumbers()
        updateTempo();
        updateVolume();
    </script>
</body>
</html>